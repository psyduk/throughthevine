{% extends 'layout.html' %}
{% block content %}
<div class="row-fluid video-wrapper">
  <div class="span4 video">
    <video class="vid" id="video_0" width="100%" height="100%" preload="auto" poster="{{ vids[0].poster }}">
      <source src="{{ vids[0].video }}" type="video/mp4">
    </video>
    <div class="av">
      <a href={{ vids[0].url }}><img class="avatar" src="{{ vids[0].avatar }}"></a>
      <span class="text"><strong>{{ vids[0].username }}</strong> - {{ vids[0].tagline }}</span>
    </div>
  </div>
  <div class="span4 video">
    <video class="vid" id="video_1" width="100%" height="100%" preload="auto" poster="{{ vids[1].poster }}">
      <source src="{{ vids[1].video }}" type="video/mp4">
    </video>
    <div class="av">
      <a href="{{ vids[1].url }}"><img class="avatar" src="{{ vids[1].avatar }}"></a>
      <span class="text"><strong>{{ vids[1].username }}</strong> - {{ vids[1].tagline }}</span>
    </div>
  </div>
  <div class="span4 video">
    <video class="vid" id="video_2" width="100%" height="100%" preload="auto" poster={{ vids[2].poster }}>
      <source src="{{ vids[2].video }}" type="video/mp4">
    </video>
    <div class="av">
      <a href="{{ vids[2].url }}"><img class="avatar" src="{{ vids[2].avatar }}"></a>
      <span class="text"><strong>{{ vids[2].username }}</strong> - {{ vids[2].tagline }}</span>
    </div>
  </div>
</div>

<div class="searchbar">
  <form class="form" action="/vine" method="GET">
    <input type="text" name="keywords" placeholder="{{ query }}">
    <button type="submit" class="submit" style="display: none;"></button>
  </form>
  <div class="vine-v"></div>
  <div class="play playVideos">
    <i class="icon-play"></i>
  </div>
  <div class="semi-circle">
    <i class="icon-twitter"></i>
    <div class="share-container">
      <div class="share-bubble">
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://throughthevine.jitsu.com{{id}}" data-text="View {{query}} Vine Videos at">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        <div id="copy-button" data-clipboard-text="http://throughthevine.jitsu.com/share/{{ id }}" class="btn btn-primary">Copy Link</div>
      </div>
    </div>
  </div>
</div>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="/js/ZeroClipboard.min.js"></script>
<script>
console.log('query', '{{ query }}');
console.log('id',    '{{ id }}');

var clip = new ZeroClipboard(document.getElementById("copy-button"), {
  moviePath: "/swf/ZeroClipboard.swf"
});

var playVideo = function (el) {
  if (!el) { return; }
  if (el.getAttribute('controls') !== 'true') {
      el.setAttribute('controls', 'true');
  }
  el.paused ? el.play() : el.pause();
  el.removeAttribute('controls');
}

$('.playVideos').on('click', function (e) {
  console.log('playing videos');
  playVideo($('#video_0' ).get(0));
  $('#video_0').one('ended', function (e) {
    playVideo($('#video_1' ).get(0));
    $('#video_1').one('ended', function (e) {
      playVideo($('#video_2' ).get(0));
      $('#video_2').one('ended', function (e) {
        console.log('ended');
      });
    });
  });
});

</script>
{% endblock %}
